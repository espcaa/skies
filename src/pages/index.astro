---
import { Image } from "astro:assets";
import "./style.css";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
const skies = await getCollection("skies");
const randomIndex = Math.floor(Math.random() * skies.length);
const randomSky = skies[randomIndex];
---

<Layout>
    <main id="theme-wrapper">
        <div class="mainContainer">
            <Image
                id="dynamic-img"
                src={randomSky.data.image}
                loading="eager"
                alt=""
                class="responsive round"
                style={{
                    "object-fit": "cover",
                    height: "70vh",
                }}
            />
            <div class="info">
                <p class="camera">{randomSky.data.camera}</p>
                <p class="location">{randomSky.data.location}</p>
                <p class="description">{randomSky.data.description}</p>
                <p class="date">{randomSky.data.date.toLocaleDateString()}</p>
            </div>
        </div>
    </main>
</Layout>

<script>
    import materialDynamicColors from "material-dynamic-colors";
    import type { IMaterialDynamicColorsThemeColor } from "material-dynamic-colors/src/cdn/interfaces";

    async function applyTheme() {
        const img = document.getElementById("dynamic-img") as HTMLImageElement;
        const wrapper = document.getElementById("theme-wrapper");

        if (img && wrapper) {
            const theme = await materialDynamicColors(img.src);

            let cssVars = "";
            for (const [key, value] of Object.entries(theme.light)) {
                const darkColor = theme.dark[key as keyof typeof theme.dark];
                cssVars += `--md-${key}: light-dark(${value}, ${darkColor}); `;
            }

            wrapper.setAttribute(
                "style",
                cssVars + "height: 70vh; object-fit: cover;",
            );
        }
    }

    window.addEventListener("load", applyTheme);
</script>
